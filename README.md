# AltaSoft.Choice

[![NuGet - AltaSoft.Choice](https://img.shields.io/nuget/v/AltaSoft.Choice?label=AltaSoft.Choice)](https://www.nuget.org/packages/AltaSoft.Choice)
[![NuGet - AltaSoft.Choice.Generator](https://img.shields.io/nuget/v/AltaSoft.Choice.Generator?label=AltaSoft.Choice.Generator)](https://www.nuget.org/packages/AltaSoft.Choice.Generator)
[![Dot NET 8+](https://img.shields.io/static/v1?label=DOTNET&message=8%2B&color=0c3c60&style=for-the-badge)](https://dotnet.microsoft.com)

**AltaSoft.ChoiceGenerator** is a lightweight C# source generator that allows you to define *choice types* (discriminated unions) with minimal syntax.

---

## ✨ Features

- Simple `[Choice]` attribute for defining alternatives
- Generates type-safe properties
- Supports XML and System.Text.Json serialization
- Includes `CreateAsXxx`, `Match`, and `Switch` methods
- Auto-generates enum for valid choice types

---

## 🛠️ Installation

Add the following NuGet packages to your project:

```xml
<ItemGroup>
  <PackageReference Include="AltaSoft.Choice" Version="x.x.x" />
  <PackageReference Include="AltaSoft.Choice.Generator" Version="x.x.x" PrivateAssets="all" />
</ItemGroup>
```

---

## ✅ Define Your Choice Type

Mark your class with `[Choice]` and define **partial nullable properties** :

```csharp
using AltaSoft.Choice;
namespace AltaSoft.ChoiceGenerator.Tests;

[Choice]
public sealed partial class AccountIdentification4Choice
{

    /// <summary>
    /// <para>International Bank Account Number (IBAN) - identifier used internationally by financial institutions to uniquely identify the account of a customer. Further specifications of the format and content of the IBAN can be found in the standard ISO 13616 &quot;Banking and related financial services - International Bank Account Number (IBAN)&quot; version 1997-10-01, or later revisions.</para>
    /// </summary>
    [JsonPropertyName("iban")]
    [XmlElement("IBAN")]
    public partial IBAN2007Identifier? IBAN { get; set; }

    /// <summary>
    /// <para>Unique identification of an account, as assigned by the account servicer, using an identification scheme.</para>
    /// </summary>

    [JsonPropertyName("other")]
    [XmlElement("other")]
    public partial GenericAccountIdentification1? Other { get; set; }

}
```

---

## ⚙️ Generated Code

Below is the generated code for the example above:

```csharp
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by 'AltaSoft Choice.Generator'.
//     Changes to this file may cause incorrect behavior and will be lost if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#nullable enable

using AltaSoft.ChoiceGenerator.Tests;
using System;
using System.ComponentModel;
using System.Text.Json;
using System.Text.Json.Serialization;
using System.Xml.Serialization;


namespace AltaSoft.ChoiceGenerator.Tests;

public sealed partial class AccountIdentification4Choice
{

    /// <summary>
    /// <para> Choice element. One of: <list type="bullet"/> <para><item><term>IBAN</term></item><description>IBAN <see cref = "IBAN2007Identifier"/></description> - International Bank Account Number (IBAN) - identifier used internationally by financial institutions to uniquely identify the account of a customer. Further specifications of the format and content of the IBAN can be found in the standard ISO 13616 "Banking and related financial services - International Bank Account Number (IBAN)" version 1997-10-01, or later revisions.  </para><para><item><term>other</term></item><description>Other <see cref = "GenericAccountIdentification1"/></description> - Unique identification of an account, as assigned by the account servicer, using an identification scheme.  </para> </para>
    /// </summary>
    [XmlElement("IBAN", typeof(IBAN2007Identifier))]
    [XmlElement("other", typeof(GenericAccountIdentification1))]
    [XmlChoiceIdentifier(nameof(ChoiceType))]
    [JsonIgnore]
    [Browsable(false), EditorBrowsable(EditorBrowsableState.Never)]
    public object Item { get; set; } = default!;

    /// <summary>
    /// <para>Choice enum </para>
    /// </summary>
    [XmlIgnore]
    [JsonIgnore]
    public ChoiceOf ChoiceType { get; set; }

    /// <summary>
    /// International Bank Account Number (IBAN) - identifier used internationally by financial institutions to uniquely identify the account of a customer. Further specifications of the format and content of the IBAN can be found in the standard ISO 13616 "Banking and related financial services - International Bank Account Number (IBAN)" version 1997-10-01, or later revisions.
    /// </summary>
    [XmlIgnore]
    [JsonInclude]
    public partial IBAN2007Identifier? IBAN { get => ChoiceType == ChoiceOf.IBAN ? GetAsIBAN() : (IBAN2007Identifier?)null; set => SetAsIBAN(value ?? throw new JsonException("Choice value cannot be null")); }

    /// <summary>
    /// Unique identification of an account, as assigned by the account servicer, using an identification scheme.
    /// </summary>
    [XmlIgnore]
    [JsonInclude]
    public partial GenericAccountIdentification1? Other { get => ChoiceType == ChoiceOf.Other ? GetAsOther() : (GenericAccountIdentification1?)null; set => SetAsOther(value ?? throw new JsonException("Choice value cannot be null")); }


    private IBAN2007Identifier GetAsIBAN() => (IBAN2007Identifier)Item;

    private void SetAsIBAN(IBAN2007Identifier value)
    {
        Item = value;
        ChoiceType = ChoiceOf.IBAN;
    }

    /// <summary>
    /// Creates a new <see cref="AltaSoft.ChoiceGenerator.Tests.AccountIdentification4Choice"/> instance and sets its value using the specified <see cref="IBAN2007Identifier"/>.
    /// </summary>
    /// <param name="value">The value to assign to the created choice instance.</param>
    public static AltaSoft.ChoiceGenerator.Tests.AccountIdentification4Choice CreateAsIBAN(IBAN2007Identifier value)
    {
        var instance = new AltaSoft.ChoiceGenerator.Tests.AccountIdentification4Choice();
        instance.SetAsIBAN(value);
        return instance;
    }

    private GenericAccountIdentification1 GetAsOther() => (GenericAccountIdentification1)Item;

    private void SetAsOther(GenericAccountIdentification1 value)
    {
        Item = value;
        ChoiceType = ChoiceOf.Other;
    }

    /// <summary>
    /// Creates a new <see cref="AltaSoft.ChoiceGenerator.Tests.AccountIdentification4Choice"/> instance and sets its value using the specified <see cref="GenericAccountIdentification1"/>.
    /// </summary>
    /// <param name="value">The value to assign to the created choice instance.</param>
    public static AltaSoft.ChoiceGenerator.Tests.AccountIdentification4Choice CreateAsOther(GenericAccountIdentification1 value)
    {
        var instance = new AltaSoft.ChoiceGenerator.Tests.AccountIdentification4Choice();
        instance.SetAsOther(value);
        return instance;
    }

    /// <summary>
    /// <para>Applies the appropriate function based on the current choice type</para>
    /// </summary>
    /// <typeparam name="TResult">The return type of the provided match functions</typeparam>
    /// <param name="matchIBAN">Function to invoke if the choice is a <see cref="ChoiceOf.IBAN"/> value</param>
    /// <param name="matchOther">Function to invoke if the choice is a <see cref="ChoiceOf.Other"/> value</param>
    public TResult Match<TResult>(
    	Func<IBAN2007Identifier, TResult> matchIBAN, 
    	Func<GenericAccountIdentification1, TResult> matchOther)
    {
        if(ChoiceType == ChoiceOf.IBAN)
        	return matchIBAN(IBAN!);

        if(ChoiceType == ChoiceOf.Other)
        	return matchOther(Other!);

        throw new InvalidOperationException($"Invalid ChoiceType. '{ChoiceType}'");
    }

    /// <summary>
    /// <para>Applies the appropriate Action based on the current choice type</para>
    /// </summary>
    /// <param name="matchIBAN">Action to invoke if the choice is a <see cref="ChoiceOf.IBAN"/> value</param>
    /// <param name="matchOther">Action to invoke if the choice is a <see cref="ChoiceOf.Other"/> value</param>
    public void Switch(
    	Action<IBAN2007Identifier> matchIBAN, 
    	Action<GenericAccountIdentification1> matchOther)
    {
        if(ChoiceType == ChoiceOf.IBAN!)
        {
            matchIBAN(IBAN!);
            return;
        }

        if(ChoiceType == ChoiceOf.Other!)
        {
            matchOther(Other!);
            return;
        }

        throw new InvalidOperationException($"Invalid ChoiceType. '{ChoiceType}'");
    }

    /// <summary>
    /// <para>Choice enumeration</para>
    /// </summary>
    [Serializable]
    [XmlType("AccountIdentification4Choice__ChoiceOf")]
    public enum ChoiceOf
    {
        /// <summary>
        /// International Bank Account Number (IBAN) - identifier used internationally by financial institutions to uniquely identify the account of a customer. Further specifications of the format and content of the IBAN can be found in the standard ISO 13616 "Banking and related financial services - International Bank Account Number (IBAN)" version 1997-10-01, or later revisions.
        /// </summary>
        [XmlEnum("IBAN")]
        IBAN, 
        /// <summary>
        /// Unique identification of an account, as assigned by the account servicer, using an identification scheme.
        /// </summary>
        [XmlEnum("other")]
        Other, 
    }
}
```

---

## 💡 Example Usage

```csharp
var account = AccountIdentification4Choice.CreateAsIBAN("DE89370400440532013000");

var result = choice.Match(
    iban => $"It's an iban: {iban}",
    other => $"It's other: {other.ToString()}"
);

choice.Switch(
    iban => Console.WriteLine($"String: {iban}"),
    other => Console.WriteLine($"Number: {other.ToString()}")
);
```
---

## 📦 Projects

- `AltaSoft.Choice`  
  Contains the `[Choice]` marker attribute

- `AltaSoft.Choice.Generator`  
  Implements the source generator that produces boilerplate code

---

## 📄 License

This project is licensed under the [MIT License](LICENSE).
